### 1-Dart的异步模型

**1.1 如何处理耗时的操作呢？**

- 针对如何处理耗时的操作，不同的语言有不同的处理方式。

- **处理方式一：** 多线程，比如Java、C++，我们普遍的做法是开启一个新的线程（Thread），在新的线程中完成这些异步的操作，再通过线程间通信的方式，将拿到的数据传递给主线程。

- **处理方式二：** 单线程+事件循环，比如JavaScript、Dart都是基于单线程加事件循环来完成耗时操作的处理。不过单线程如何能进行耗时的操作呢？

**1.2 单线程的异步操作**

如果想搞懂这个点，我们需要知道操作系统中的`阻塞式调用`和`非阻塞式调用`的概念。

- 阻塞和非阻塞关注的是**程序在等待调用结果（消息，返回值）时的状态。**
- **阻塞式调用：** 调用结果返回之前，当前线程会被挂起，调用线程只有在得到调用结果之后才会继续执行。
- **非阻塞式调用：** 调用执行之后，当前线程不会停止执行，只需要过一段时间来检查一下有没有结果返回即可。

我们用一个生活中的例子来模拟：

- 你中午饿了，需要点一份外卖，点`外卖的动作`就是我们的调用，拿到`最后点的外卖`就是我们要等待的结果。

- **阻塞式调用：** 点了外卖，不再做任何事情，就是在傻傻的等待，你的线程停止了任何其他的工作。

- **非阻塞式调用：** 点了外卖，继续做其他事情：继续工作、打把游戏，你的线程没有继续执行其他事情，只需要偶尔去看一下有没有人敲门，外卖有没有送到即可。

而我们开发中的很多耗时操作，都可以基于这样的 `非阻塞式调用`：

  - 比如网络请求本身使用了Socket通信，而Socket本身提供了select模型，可以进行`非阻塞方式的工作`；
  - 比如文件读写的IO操作，我们可以使用操作系统提供的`基于事件的回调机制`；

  这些操作都不会阻塞我们单线程的继续执行，我们的线程在等待的过程中可以继续去做别的事情，等真正有了响应，再去进行对应的处理即可。



### 2 Dart事件循环

#### 2.1 什么是事件循环

单线程模型中主要就是在维护着一个事件循环（Event Loop）。

事件循环是什么呢？

- 事实上事件循环它就是将需要处理的一系列事件（包括点击事件、IO事件、网络事件）放在一个事件队列（Event Queue）中。
- 不断的从事件队列（Event Queue）中取出事件，并执行其对应需要执行的代码块，直到事件队列清空为止。

模拟事件循环的伪代码：

```
List eventQueue = []; 
var event;

// 事件队列遵循先进先出原则，事件循环从启动的一刻，永远在执行
while (true) {
  if (eventQueue.length > 0) {
    // 取出一个事件
    event = eventQueue.removeAt(0);
    // 执行该事件
    event();
  }
}
```



### 3. Dart的异步操作

Dart中的异步操作主要使用Future以及async、await。











